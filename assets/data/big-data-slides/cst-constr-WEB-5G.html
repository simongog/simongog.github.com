<!DOCTYPE html>
<meta charset="utf-8">
<style>
    body { font: 11px sans-serif; }
    .rule { height: 90%; position: absolute; border-right: 1px dotted #000; text-align: right; }
</style>
<title>sdsl memory usage visualization</title>
<script src="http://d3js.org/d3.v3.js"></script>
<body marginwidth="0" marginheight="0">
<button><a id="download">Save as SVG</a></button>

<div class="chart"><div id="vis_cst_const"></div></div>


<script>
var events = [
	{
		"name" : "unknown",
		"usage" : [
			[0,32],
			[4130733,32]
		]
	},
	{
		"name" : "construct CST",
		"usage" : [
			[0,32],
			[2375383,32],
			[2406613,32],
			[2406613,6357491008],
			[2406613,6357489576],
			[2406631,6357489576],
			[2406631,6011459488],
			[2406668,6011459488],
			[2406669,5319094680],
			[2406669,5319094680],
			[2406670,5318754200],
			[2406670,5318754200],
			[2406671,5318575000],
			[2406672,5318575000],
			[2406673,5318180760],
			[2406673,5318180760],
			[2406674,5317750680],
			[2406674,5317750680],
			[2406675,5317392280],
			[2406675,5317392280],
			[2406675,5317338520],
			[2406676,5317338520],
			[2406677,5317105560],
			[2406677,5317105560],
			[2406678,5316783000],
			[2406678,5316783000],
			[2406679,5316514200],
			[2406680,5316514200],
			[2406681,5316191640],
			[2406682,5316191640],
			[2406683,5316012440],
			[2406683,5316012440],
			[2406684,5315492760],
			[2406684,5315492760],
			[2406685,5315349400],
			[2406685,5315349400],
			[2406686,5315044760],
			[2406686,5315044760],
			[2406687,5314578840],
			[2406687,5314578840],
			[2406688,5314005400],
			[2406689,5314005400],
			[2406689,5313736600],
			[2406690,5313736600],
			[2406690,5313306520],
			[2406692,5313306520],
			[2406693,5313163160],
			[2406693,5313163160],
			[2406694,5312553880],
			[2406694,5312553880],
			[2406695,5312231320],
			[2406695,5312231320],
			[2406696,5311926680],
			[2406697,5311926680],
			[2406698,5311478680],
			[2406698,5311478680],
			[2406699,5311335320],
			[2406699,5311335320],
			[2406700,5311156120],
			[2406700,5311156120],
			[2406700,5310797720],
			[2406704,5310797720],
			[2406704,5310278040],
			[2406705,5310278040],
			[2406706,5310116760],
			[2407949,4559378760],
			[2407950,4558559776],
			[2407950,4558559776],
			[2407951,4557743216],
			[2407951,4557743216],
			[2407952,4556921728],
			[2407952,4556921728],
			[2407953,4556113192],
			[2407953,4556113192],
			[2407954,4555291928],
			[2407954,4555291928],
			[2407955,4554472592],
			[2407955,4554472592],
			[2407956,4553653960],
			[2407956,4553653960],
			[2407957,4552858448],
			[2407957,4552858448],
			[2407958,4552039680],
			[2407958,4552039680],
			[2407959,4551213024],
			[2407959,4551213024],
			[2407960,4550381872],
			[2407960,4550381872],
			[2407961,4549566392],
			[2407961,4549566392],
			[2407962,4548737072],
			[2407962,4548737072],
			[2407963,4547912616],
			[2407963,4547912616],
			[2407964,4547099976],
			[2407964,4547099976],
			[2407965,4546290920],
			[2407965,4546290920],
			[2407966,4545472008],
			[2407966,4545472008],
			[2407967,4544656032],
			[2407967,4544656032],
			[2407968,4543839000],
			[2407968,4543839000],
			[2407969,4543050712],
			[2407969,4543050712],
			[2407970,4542221408],
			[2407970,4542221408],
			[2407971,4541401288],
			[2407971,4541401288],
			[2407972,4540578664],
			[2407972,4540578664],
			[2407973,4539761632],
			[2407973,4539761632],
			[2407974,4538940080],
			[2407974,4538940080],
			[2407975,4538119536],
			[2407975,4538119536],
			[2407976,4537300016],
			[2407976,4537300016],
			[2407977,4536493808],
			[2407977,4536493808],
			[2407978,4535673104],
			[2407978,4535673104],
			[2407979,4534855544],
			[2407979,4534855544],
			[2407980,4534032920],
			[2407980,4534032920],
			[2407981,4533237624],
			[2407981,4533237624],
			[2407982,4532419128],
			[2407982,4532419128],
			[2407983,4531599528],
			[2407983,4531599528],
			[2407984,4530775000],
			[2407984,4530775000],
			[2407985,4529964488],
			[2407985,4529964488],
			[2407986,4529146672],
			[2407986,4529146672],
			[2407987,4528323840],
			[2407987,4528323840],
			[2407988,4527502432],
			[2407988,4527502432],
			[2407989,4526692800],
			[2407989,4526692800],
			[2407990,4525869680],
			[2407990,4525869680],
			[2407990,4525705200],
			[2407995,4525705200],
			[2407995,4509399600],
			[2408043,4509399600],
			[2408043,3607519680],
			[2408237,3607519680],
			[2408237,32],
			[3583541,32],
			[4122301,32],
			[4130733,32],
			[4130733,18078779144]
		]
	},
	{
		"name" : "construct CSA",
		"usage" : [
			[0,32],
			[9308,32],
			[1747368,32],
			[2198228,32],
			[2375383,32],
			[2375383,6357491008]
		]
	},
	{
		"name" : "parse input text",
		"usage" : [
			[0,5368709152],
			[5472,5368709152],
			[5472,5368709160],
			[9308,5368709160],
			[9308,32],
			[9308,32]
		]
	},
	{
		"name" : "SA",
		"usage" : [
			[9308,5368709160],
			[12228,5368709160],
			[12228,27514634288],
			[22569,27514634288],
			[22569,48318382128],
			[1572586,48318382128],
			[1572586,27514634288],
			[1747018,27514634288],
			[1747018,5368709160],
			[1747368,5368709160],
			[1747368,32],
			[1747368,32]
		]
	},
	{
		"name" : "BWT",
		"usage" : [
			[1747368,5368709160],
			[1750348,5368709160],
			[1750349,5370709192],
			[2197972,5370709192],
			[2197972,5368709160],
			[2198228,5368709160],
			[2198228,32],
			[2198228,32]
		]
	},
	{
		"name" : "construct CSA",
		"usage" : [
			[2198228,32],
			[2211269,32],
			[2296315,32],
			[2330582,32],
			[2375383,32],
			[2375383,6357491008]
		]
	},
	{
		"name" : "construct csa-alpbabet",
		"usage" : [
			[2198229,1051176],
			[2211269,1051176],
			[2211269,1464],
			[2211269,1464]
		]
	},
	{
		"name" : "construct wavelet tree",
		"usage" : [
			[2211269,1050040],
			[2226368,1050040],
			[2226368,3608569688],
			[2268495,3608569688],
			[2268495,4510449608],
			[2270412,4510449608],
			[2270412,4524969992],
			[2270419,4524969992],
			[2270419,4524970360],
			[2270623,4524970360],
			[2270623,4524982136],
			[2270630,4524982136],
			[2270630,4525009208],
			[2270644,4525009208],
			[2270644,4525024712],
			[2270653,4525024712],
			[2270653,4525040368],
			[2270660,4525040368],
			[2270660,4525053680],
			[2270684,4525053680],
			[2270685,4525132024],
			[2270685,4525132024],
			[2270686,4525211688],
			[2270686,4525211688],
			[2270687,4525290936],
			[2270687,4525290936],
			[2270688,4525370808],
			[2270688,4525370808],
			[2270689,4525447168],
			[2270689,4525447168],
			[2270690,4525527144],
			[2270690,4525527144],
			[2270691,4525601656],
			[2270691,4525601656],
			[2270692,4525681632],
			[2270692,4525681632],
			[2270693,4525760984],
			[2270693,4525760984],
			[2270694,4525840440],
			[2270694,4525840440],
			[2270695,4525920416],
			[2270695,4525920416],
			[2270696,4525999872],
			[2270696,4525999872],
			[2270697,4526078912],
			[2270697,4526078912],
			[2270698,4526158784],
			[2270698,4526158784],
			[2270699,4526238552],
			[2270699,4526238552],
			[2270700,4526307024],
			[2270700,4526307024],
			[2270701,4526371992],
			[2270701,4526371992],
			[2270702,4526441304],
			[2270702,4526441304],
			[2270703,4526493896],
			[2270703,4526493896],
			[2270704,4526527448],
			[2270711,4526527448],
			[2270712,4526585840],
			[2270712,4526585840],
			[2270713,4526636432],
			[2270713,4526636432],
			[2270714,4526688528],
			[2270714,4526688528],
			[2270715,4526733728],
			[2270715,4526733728],
			[2270716,4526781592],
			[2270716,4526781592],
			[2270717,4526847376],
			[2270717,4526847376],
			[2270718,4526900128],
			[2270718,4526900128],
			[2270719,4526945648],
			[2270719,4526945648],
			[2270720,4526984936],
			[2270720,4526984936],
			[2270721,4527032520],
			[2270721,4527032520],
			[2270722,4527079600],
			[2270722,4527079600],
			[2270723,4527125568],
			[2270723,4527125568],
			[2270724,4527162616],
			[2270724,4527162616],
			[2270725,4527204704],
			[2270725,4527204704],
			[2270726,4527255664],
			[2270726,4527255664],
			[2270727,4527301624],
			[2270727,4527301624],
			[2270728,4527362000],
			[2270728,4527362000],
			[2270728,4527395960],
			[2270730,4527395960],
			[2270731,4527456152],
			[2270731,4527456152],
			[2270732,4527499896],
			[2270732,4527499896],
			[2270733,4527547056],
			[2270733,4527547056],
			[2270734,4527605272],
			[2270734,4527605272],
			[2270735,4527664752],
			[2270738,4527664752],
			[2270738,4527684256],
			[2270741,4527684256],
			[2270742,4527740752],
			[2270744,4527740752],
			[2270745,4527803624],
			[2270745,4527803624],
			[2270746,4527843816],
			[2270746,4527843816],
			[2270747,4527901528],
			[2270747,4527901528],
			[2270748,4527956128],
			[2270748,4527956128],
			[2270749,4528001960],
			[2270749,4528001960],
			[2270750,4528077760],
			[2270750,4528077760],
			[2270751,4528154176],
			[2270751,4528154176],
			[2270752,4528231968],
			[2270752,4528231968],
			[2270753,4528310072],
			[2270753,4528310072],
			[2270754,4528388208],
			[2270754,4528388208],
			[2270755,4528467456],
			[2270755,4528467456],
			[2270756,4528541520],
			[2270756,4528541520],
			[2270757,4528612208],
			[2270757,4528612208],
			[2270758,4528679360],
			[2270758,4528679360],
			[2270759,4528724352],
			[2270759,4528724352],
			[2270760,4528774240],
			[2270760,4528774240],
			[2270761,4528824728],
			[2270761,4528824728],
			[2270762,4528884976],
			[2270762,4528884976],
			[2270763,4528934544],
			[2270763,4528934544],
			[2270764,4528985200],
			[2270764,4528985200],
			[2270765,4529035624],
			[2270765,4529035624],
			[2270766,4529078064],
			[2270766,4529078064],
			[2270766,4529092912],
			[2270771,4529092912],
			[2270772,4529146960],
			[2270772,4529146960],
			[2270773,4529205736],
			[2270774,4529205736],
			[2270775,4529245192],
			[2270777,4529245192],
			[2270778,4529289520],
			[2270778,4529289520],
			[2270779,4529342704],
			[2270779,4529342704],
			[2270780,4529394408],
			[2270780,4529394408],
			[2270781,4529445768],
			[2270782,4529445768],
			[2270782,4529460616],
			[2270810,4529460616],
			[2270811,4529513496],
			[2270811,4529513496],
			[2270811,4529535464],
			[2270814,4529535464],
			[2270815,4529596896],
			[2270815,4529596896],
			[2270815,4529624184],
			[2270820,4529624184],
			[2270821,4529673656],
			[2270821,4529673656],
			[2270822,4529747840],
			[2270822,4529747840],
			[2270823,4529803088],
			[2270823,4529803088],
			[2270823,4529836488],
			[2270825,4529836488],
			[2270826,4529896856],
			[2270826,4529896856],
			[2270827,4529956752],
			[2296306,5319972384],
			[2296307,5319991472],
			[2296308,5319991472],
			[2296309,5320065608],
			[2296309,5320065608],
			[2296310,5320130888],
			[2296310,5320130888],
			[2296311,5320200472],
			[2296311,5320200472],
			[2296312,5320268464],
			[2296312,5320268464],
			[2296313,5320338784],
			[2296313,5320338784],
			[2296314,5320402616],
			[2296314,5320402616],
			[2296315,5319400752],
			[2296315,5319400752]
		]
	},
	{
		"name" : "sample SA",
		"usage" : [
			[2296315,5320449360],
			[2296316,5320449360],
			[2296316,6012509528],
			[2330582,6012509528],
			[2330582,6011460920],
			[2330582,6011460920]
		]
	},
	{
		"name" : "sample ISA",
		"usage" : [
			[2330582,6358539616],
			[2375383,6358539616],
			[2375383,6357491008],
			[2375383,6357491008]
		]
	},
	{
		"name" : "store CSA",
		"usage" : [
			[2375383,6357491008],
			[2378474,6357491008],
			[2378474,6357956888],
			[2393629,6357956888],
			[2393629,6357491008],
			[2393639,6357491008],
			[2393639,6357905880],
			[2405849,6357905880],
			[2405849,6357491008],
			[2406613,6357491008]
		]
	},
	{
		"name" : "LCP",
		"usage" : [
			[2408237,32],
			[2408248,32],
			[2408249,672137288],
			[2451451,672137288],
			[2451451,6040846416],
			[2462068,6040846416],
			[2462068,6043797840],
			[2462069,6043797840],
			[2462069,6047797872],
			[3583230,6047797872],
			[3583230,6043797840],
			[3583507,6043797840],
			[3583507,675088712],
			[3583541,675088712],
			[3583541,32],
			[3583541,32]
		]
	},
	{
		"name" : "CST",
		"usage" : [
			[3583541,64],
			[3788869,64],
			[3823252,64],
			[4045099,64],
			[4122301,18078779144],
			[4122301,18078779144]
		]
	},
	{
		"name" : "bps-sct",
		"usage" : [
			[3583542,2014314608],
			[3584525,2014314608],
			[3584525,2696055456],
			[3584853,2696055456],
			[3584853,3367144104],
			[3788836,3367144104],
			[3788836,2696055456],
			[3788868,2696055456],
			[3788869,2013266000],
			[3788869,2013266000]
		]
	},
	{
		"name" : "bpss-sct",
		"usage" : [
			[3788869,2097152096],
			[3789570,2097152096],
			[3789570,2102722664],
			[3789571,2102722664],
			[3789572,2102774848],
			[3789572,2102774848],
			[3789573,2102829008],
			[3789573,2102829008],
			[3789574,2102882792],
			[3789574,2102882792],
			[3789575,2102935920],
			[3789575,2102935920],
			[3789576,2102987968],
			[3789576,2102987968],
			[3789577,2103042000],
			[3789577,2103042000],
			[3789578,2103096040],
			[3789578,2103096040],
			[3789579,2103149504],
			[3789579,2103149504],
			[3789580,2103203480],
			[3789580,2103203480],
			[3789581,2103257864],
			[3789581,2103257864],
			[3789582,2103312264],
			[3789582,2103312264],
			[3789583,2103366640],
			[3789583,2103366640],
			[3789584,2103420648],
			[3789584,2103420648],
			[3789585,2103474448],
			[3789585,2103474448],
			[3789586,2103524872],
			[3789586,2103524872],
			[3789587,2103577752],
			[3789587,2103577752],
			[3789588,2103629704],
			[3789588,2103629704],
			[3789589,2103683136],
			[3789589,2103683136],
			[3789590,2103736920],
			[3789590,2103736920],
			[3789591,2103790376],
			[3789591,2103790376],
			[3789592,2103843888],
			[3789592,2103843888],
			[3789593,2103898352],
			[3789593,2103898352],
			[3789594,2103951112],
			[3789594,2103951112],
			[3789595,2104004888],
			[3789595,2104004888],
			[3789596,2104057048],
			[3789596,2104057048],
			[3789597,2104110816],
			[3789597,2104110816],
			[3789598,2104163832],
			[3789598,2104163832],
			[3789599,2104217232],
			[3789599,2104217232],
			[3789600,2104269216],
			[3789600,2104269216],
			[3789601,2104322144],
			[3789601,2104322144],
			[3789602,2104372496],
			[3789602,2104372496],
			[3789603,2104426048],
			[3789603,2104426048],
			[3789604,2104478984],
			[3789604,2104478984],
			[3789605,2104533264],
			[3789605,2104533264],
			[3789606,2104587584],
			[3789606,2104587584],
			[3789607,2104642328],
			[3789607,2104642328],
			[3789608,2104695640],
			[3789608,2104695640],
			[3789609,2104749120],
			[3789609,2104749120],
			[3789610,2104802448],
			[3789610,2104802448],
			[3789611,2104856408],
			[3789611,2104856408],
			[3789612,2104910040],
			[3789612,2104910040],
			[3789613,2104963728],
			[3789613,2104963728],
			[3789614,2105017304],
			[3789614,2105017304],
			[3789615,2105071792],
			[3789615,2105071792],
			[3789616,2105126176],
			[3789616,2105126176],
			[3789617,2105179904],
			[3789617,2105179904],
			[3789618,2105233864],
			[3789618,2105233864],
			[3789619,2105288528],
			[3789619,2105288528],
			[3789620,2105342880],
			[3789620,2105342880],
			[3789621,2105396456],
			[3789621,2105396456],
			[3789622,2105450128],
			[3789622,2105450128],
			[3789623,2105505872],
			[3789623,2105505872],
			[3789624,2105558104],
			[3789624,2105558104],
			[3789625,2105611704],
			[3789625,2105611704],
			[3789626,2105665184],
			[3789626,2105665184],
			[3789627,2105718928],
			[3789627,2105718928],
			[3789628,2105771608],
			[3789628,2105771608],
			[3789629,2105825032],
			[3789629,2105825032],
			[3789630,2105879480],
			[3789630,2105879480],
			[3789631,2105933624],
			[3789631,2105933624],
			[3789632,2105987464],
			[3789632,2105987464],
			[3789633,2106040960],
			[3789633,2106040960],
			[3789634,2106089344],
			[3789634,2106089344],
			[3789635,2106142688],
			[3789635,2106142688],
			[3789636,2106196480],
			[3789636,2106196480],
			[3789637,2106250136],
			[3789637,2106250136],
			[3789638,2106303584],
			[3789638,2106303584],
			[3789639,2106358856],
			[3789639,2106358856],
			[3789640,2106412520],
			[3789640,2106412520],
			[3789641,2106466224],
			[3789641,2106466224],
			[3789642,2106519504],
			[3789643,2106519504],
			[3789644,2106573872],
			[3789644,2106573872],
			[3789645,2106627360],
			[3789645,2106627360],
			[3789646,2106680800],
			[3789646,2106680800],
			[3789647,2106734984],
			[3789647,2106734984],
			[3789648,2106788496],
			[3789648,2106788496],
			[3789649,2106841728],
			[3789649,2106841728],
			[3789650,2106895408],
			[3789650,2106895408],
			[3789651,2106948752],
			[3792186,2242445224],
			[3792186,2242445224],
			[3792187,2242498120],
			[3792187,2242498120],
			[3792188,2242551432],
			[3792188,2242551432],
			[3792189,2242604080],
			[3792189,2242604080],
			[3792190,2242657552],
			[3792190,2242657552],
			[3792191,2242711936],
			[3792191,2242711936],
			[3792192,2242766296],
			[3792192,2242766296],
			[3792193,2242819528],
			[3792193,2242819528],
			[3792194,2242873848],
			[3792194,2242873848],
			[3792195,2242927704],
			[3792195,2242927704],
			[3792196,2242981920],
			[3792196,2242981920],
			[3792197,2243035200],
			[3792197,2243035200],
			[3792198,2243089080],
			[3792198,2243089080],
			[3792199,2243143192],
			[3792199,2243143192],
			[3792200,2243196936],
			[3792200,2243196936],
			[3792201,2243250280],
			[3792201,2243250280],
			[3792202,2243304192],
			[3792202,2243304192],
			[3792203,2243357704],
			[3792203,2243357704],
			[3792204,2243412824],
			[3792204,2243412824],
			[3792205,2243465512],
			[3792205,2243465512],
			[3792206,2243519832],
			[3792206,2243519832],
			[3792207,2243574048],
			[3792207,2243574048],
			[3792208,2243628256],
			[3792208,2243628256],
			[3792209,2243681360],
			[3792209,2243681360],
			[3792210,2243735696],
			[3792210,2243735696],
			[3792211,2243789880],
			[3792211,2243789880],
			[3792212,2243843336],
			[3792212,2243843336],
			[3792213,2243897208],
			[3792213,2243897208],
			[3792214,2243950600],
			[3792214,2243950600],
			[3792215,2244003232],
			[3792215,2244003232],
			[3792215,2244012800],
			[3792271,2244012800],
			[3792271,2338402056],
			[3792289,2338402056],
			[3792289,2368220936],
			[3823003,2368220936],
			[3823003,2410163992],
			[3823252,2410163992]
		]
	},
	{
		"name" : "clcp",
		"usage" : [
			[3823252,2410163992],
			[3823252,2410163992],
			[3823253,2411212744],
			[3887517,2411212744],
			[3887517,4220283312],
			[3888348,4220283312],
			[3888348,11609270072],
			[4044427,11609270072],
			[4044427,11722336984],
			[4045099,11722336984],
			[4045099,11721288200],
			[4045099,11721288200]
		]
	},
	{
		"name" : "load csa",
		"usage" : [
			[4045100,15328807848],
			[4085581,15328807848],
			[4085581,16230687768],
			[4097884,16230687768],
			[4097884,16246993368],
			[4098057,16246993368],
			[4098057,16247459248],
			[4098467,16247459248],
			[4098467,16247655344],
			[4098468,16247655344],
			[4098469,16247842232],
			[4098469,16247842232],
			[4098470,16248024680],
			[4098470,16248024680],
			[4098471,16248183000],
			[4098471,16248183000],
			[4098472,16248316536],
			[4098472,16248316536],
			[4098473,16248427504],
			[4098473,16248427504],
			[4098474,16248620216],
			[4098474,16248620216],

			[4104343,16648751832],
			[4104344,16648751832],
			[4104344,16648890064],
			[4104345,16648890064],
			[4104346,16648995808],
			[4104347,16648995808],
			[4104347,16649116536],
			[4104349,16649116536],
			[4104350,16649263800],
			[4104350,16649263800],
			[4104351,16649365920],
			[4104351,16649365920],
			[4104352,16649471664],
			[4104352,16649471664],
			[4104353,16649546112],
			[4104353,16649546112],
			[4104353,16649598920],
			[4104355,16649598920],
			[4104356,16649787472],
			[4104356,16649787472],
			[4104357,16649893136],
			[4104358,16649893136],
			[4104359,16649998800],
			[4104359,16649998800],
			[4104360,16650104376],
			[4104360,16650104376],
			[4104361,16650209920],
			[4104362,16650209920],
			[4104363,16650320032],
			[4104363,16650320032],
			[4104363,16650323056],
			[4104364,16650323056],
			[4104365,16650443800],
			[4109854,17040798880],
			[4109855,17040904544],
			[4109855,17040904544],
			[4109856,17041010184],
			[4109856,17041010184],
			[4109857,17040687488],
			[4109858,17040687488],
			[4109858,17732747656],
			[4118156,17732747656],
			[4118156,18078777744],
			[4122301,18078777744],
			[4122301,18078779176],
			[4122301,18078779176]
		]
	},
	{
		"name" : "delete temporary files",
		"usage" : [
			[4122301,18078779144],
			[4130733,18078779144]
		]
	}
]
;
var w = window,d = document,e = d.documentElement,g = d.getElementsByTagName('body')[0],
  xw = w.innerWidth || e.clientWidth || g.clientWidth,
  yh = w.innerHeight || e.clientHeight || g.clientHeight;

var margin = {top: 20,right: 80,bottom: 120,left: 120},
  width = xw - margin.left - margin.right,height = yh - margin.top - margin.bottom;
var x = d3.scale.linear().range([0, width]);
var y = d3.scale.linear().range([height, 0]);
var xAxis = d3.svg.axis().scale(x).orient("bottom");
var yAxis = d3.svg.axis().scale(y).orient("left").ticks(5);
var color = d3.scale.category10();
var x_max = d3.max(events, function (d) { return d3.max(d.usage, function (u) { return u[0] / 1000;})})
var y_max = d3.max(events, function (d) { return d3.max(d.usage, function (u) { return 1.1 * u[1] / (1024 * 1024);})})
var peak = d3.max(events, function (d) { return d3.max(d.usage, function (u) { return u[1]; })})
var data = []
events.forEach(function (d) { data = data.concat(d.usage); });
var peakelem = data.filter(function (a) { return a[1] == peak; });
var peakelem = peakelem.splice(0,1);
x.domain([0, x_max]);
 y.domain([0, y_max]);
var svg = d3.select("#vis_cst_const").append("svg")
  .attr("width", width + margin.left + margin.right)
  .attr("height", height + margin.top + margin.bottom)
  .attr("xmlns", "http://www.w3.org/2000/svg")
  .append("g").attr("transform","translate(" + margin.left + "," + margin.top + ")");

  svg.append("g").attr("class", "xaxis").attr("transform", "translate(0," + height + ")")
  .call(xAxis).append("text").attr("text-anchor", "end")
  .attr("shape-rendering", "crispEdges").attr("x", width / 2 + 50).attr("y", 70).attr("shape-rendering", "crispEdges")
  .attr("font-family", "sans-serif").attr("font-size", "20px").text("Time (seconds)");

svg.append("g").attr("class", "yaxis").call(yAxis).append("text").attr("transform", "rotate(-90)").attr("x", -height / 2 + 50)
  .attr("y", -80).attr("shape-rendering", "crispEdges").attr("font-family", "sans-serif").attr("font-size", "20px").style("text-anchor", "end")
  .text("Memory Usage (MiB)");

svg.selectAll(".tick text").style("font-size", "20px");
svg.selectAll(".xaxis .tick text").attr("dy", 23);
svg.selectAll(".yaxis .tick text").attr("dx", -10);
svg.selectAll("line").attr("fill", "none").attr("stroke", "black")
svg.selectAll("path").attr("fill", "none").attr("stroke", "black")

svg.selectAll("line.horizontalGrid").data(y.ticks(5)).enter().append("line")
  .attr({"class": "horizontalGrid","x1": 0,"x2": width,"y1": function (d) { return y(d);},
     "y2": function (d) { return y(d); }, "fill": "none", "shape-rendering": "crispEdges",
     "stroke": "lightgrey","stroke-dasharray": "10,10","stroke-width": "1.5px"});

var area = d3.svg.area().x(function (d) { return x(d[0] / 1000);}).y0(height).y1(function (d) { return y(d[1] / (1024 * 1024))});

var ev = svg.selectAll(".event").data(events).enter().append("svg:path").attr("class", "area")
  .attr("fill", function (d) { return d3.rgb(color(d.name)); })
  .attr("d", function (d) { return area(d.usage) })
  .style("stroke", function (d) { return d3.rgb(color(d.name)).darker(2);}).style("stroke-width", "2px")

svg.selectAll(".dot").data(peakelem).enter().append("circle").attr("r", 3).attr("fill", "red")
  .attr("cx", function (d) {return x(d[0] / 1000)})
  .attr("cy", function (d) {return y(d[1] / (1024 * 1024))})
  .attr("fill", "red").attr("stroke-width", 2).attr("stroke", "#cc0000")

svg.selectAll(".dot").data(peakelem).enter().append("svg:text")
  .attr("x", function (d) {return x(d[0] / 1000)}).attr("y", function (d) {return y(d[1] / (1024 * 1024) * 1.025)})
  .text(function (d) {return "Peak Usage: " + Math.round(d[1] / (1024 * 1024)) + " MB"})
  .attr("font-size", 12).attr("fill", "red");

svg.selectAll(".dot").data(peakelem).enter().append("circle")
  .attr("r", 5).attr("fill", "red")
  .attr("cx", function (d) {return x(d[0] / 1000)})
  .attr("cy", function (d) {return y(d[1] / (1024 * 1024))})
  .attr("fill", "none").attr("stroke-width", 2).attr("stroke", "#cc0000").each(pulsepeak());

function pulsepeak() { return function (d, i, j) {
  d3.select(this).attr("r", 5).style("stroke-opacity", 1.0).transition()
    .ease("linear").duration(1000).attr("r", 10).style("stroke-opacity", 0.0).each("end", pulsepeak());};}

var vertical = d3.select(".chart").append("div").attr("class", "remove")
  .style("position", "absolute").style("z-index", "19").style("width", "1px")
  .style("height", height - margin).style("top", "30px").style("bottom", "50px")
  .style("left", "0px").style("opacity", "0.4").style("background", "black");

var tooltip = d3.select(".chart").append("div").attr("class", "remove")
  .style("position", "absolute").style("z-index", "20").style("visibility", "hidden").style("top", "10px");

var circle = svg.append("circle").attr("cx", 100).attr("cy", 350).attr("r", 3).attr("fill", "black").style("opacity", "0")

d3.select("svg").on("mousemove", function () {
  mousex = d3.mouse(this);
  if (mousex[0] < margin.left + 3 || mousex[0] >= xw - margin.right) {
    vertical.style("opacity", "0"); tooltip.style("opacity", "0"); circle.style("opacity", "0")
  } else {
    var xvalue = x.invert(mousex[0] - margin.left); var pos = findPosition(xvalue)
    vertical.style("opacity", "0.4"); tooltip.style("opacity", "1"); circle.style("opacity", "1")
    circle.attr("cx", pos.x).attr("cy", pos.y); vertical.style("left", mousex[0] + "px");tooltip.style("left", mousex[0] + 15 + "px")
    tooltip.html("<p>" + xvalue.toFixed(2) + " Seconds <br>" + Math.round(pos.mem) + " MiB <br> " + pos.name +   "<br> Phase Time: " + pos.ptime + " Seconds </p>").style("visibility", "visible");
  }
}).on("mouseover", function () {
  mousex = d3.mouse(this);
  if (mousex[0] < margin.left + 3 || mousex[0] > xw - margin.right) {
    vertical.style("opacity", "0")
  } else {
    vertical.style("opacity", "0.4");vertical.style("left", mousex[0] + 7 + "px")
}})
d3.select("#download").on("click", function () {
d3.select(this).attr("href", 'data:application/octet-stream;base64,' + btoa(d3.select("#vis_cst_const").html())).attr("download", "viz.svg")})

function findPosition(e){correctArea=d3.selectAll(".area").filter(function(t){if(t.usage[0][0]<=e*1e3&&t.usage[t.usage.length-1][0]>=e*1e3){return true}return false});if(correctArea.empty()){return 0}var t=new Array;correctArea[0].forEach(function(n){t.push(findYValueinArea(n,e))});max_elem=d3.max(t,function(e){return e.mem});var n=t.filter(function(e){return e.mem==max_elem});return n[0]}function findYValueinArea(e,t){len=e.getTotalLength();var n=0;var r=len;for(var i=0;i<=len;i+=50){var s=e.getPointAtLength(i);var o=x.invert(s.x);var u=y.invert(s.y);if(u>0&&o>t){n=Math.max(0,i-50);r=i;break}}var a=e.getPointAtLength(0);var f=1;while(n<r){var l=(r+n)/2;a=e.getPointAtLength(l);target_x=x.invert(a.x);if((l==n||l==r)&&Math.abs(target_x-t)>.01){break}if(target_x>t)r=l;else if(target_x<t)n=l;else{break}if(f>50){break}f++}var c=new function(){this.mem=y.invert(a.y);this.name=e.__data__.name;this.min=d3.min(e.__data__.usage,function(e){return e[0]/1e3});this.max=d3.max(e.__data__.usage,function(e){return e[0]/1e3});this.ptime=Math.round(this.max-this.min);this.x=a.x;this.y=a.y};return c}
</script></body></html>
